create_scene_blueprint:
  description: >
    Using the current {game_state} and the latest {player_action}, design the
    next narrative scene of the murder mystery. Focus on:
    1. Where the scene takes place and who is present
    2. What is happening right now (summary and key dramatic beats)
    3. Which clues are visible to the player
    4. Which tensions or secrets are hidden beneath the surface
    5. What overall mood and visual hooks define this moment
  expected_output: >
    A valid JSON "scene_blueprint" object with at least:
    - "scene_id": unique id or name of the scene
    - "location": short description of the place
    - "summary": 2–4 sentences describing the current situation
    - "present_characters": list of character ids or names in the scene
    - "beats": ordered list of key dramatic beats
    - "visible_clues": list of clues that can be noticed now
    - "hidden_tension": 1–2 sentences about underlying conflict/secrets
    - "music_mood": a simple label for the audio agent (e.g. "tense", "calm")
    - "visual_hooks": list of strong visual elements for the vision agent
  agent: narrative_agent

define_characters:
  description: >
    Given the current scene_blueprint and the overall premise, generate a complete 
    set of four suspect profiles for the murder mystery following the exact JSON 
    schema and rules. Focus on creating distinct,vivid personalities, realistic 
    tech-industry roles, unique physical descriptions, subtle motivations, and 
    ensuring exactly one suspect is guilty. Output must be pure JSON with no extra text.


  expected_output: >
    You MUST return ONLY valid JSON, with no markdown, no backticks and no extra text.
    The JSON must have EXACTLY this structure (field names must match):

    {
      "suspects": [
        {
          "id": "suspect_1",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": false
        },
        {
          "id": "suspect_2",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": false
        },
        {
          "id": "suspect_3",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": false
        },
        {
          "id": "suspect_4",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": true
        }
      ],
      "guilty_name": "Full Name of the guilty suspect"
    }

    Constraints:
    - Roles must fit inside a tech company.
    - Personalities must be vivid and unique.
    - Physical descriptions must emphasize facial features, hair, clothing, and distinctive traits.
    - The clothing color must not repeat across suspects.
    - Motivations must feel plausible, not melodramatic.
    - Do not include explanations, commentary, or meta-reasoning.
    - Exactly 4 suspects.
    - Exactly ONE of them must have "guilty": true.
    - "guilty_name" must match the "name" of the guilty suspect.
    - Final output must be valid JSON, with no markdown and no trailing commas.
    - Do NOT wrap this JSON in ```json fences or any other text.

  agent: character_agent
  context:
    - create_scene_blueprint


generate_suspect_dialogue:
  description: >
    You are the *Suspect Dialogue Writer* in an interactive murder mystery.

    === CASE & SUSPECT DATA (FROM BACKEND) ===
    The backend passes you a string called {game_state}. It already contains:
    - A summary of the overall case (victim, time, place, cause, context).
    - The full list of suspects with their roles, personalities, secrets and alibis.
    - A clear instruction saying which suspect you must role-play as.

    {game_state}

    === SCENE & CHARACTERS (FROM OTHER AGENTS) ===
    The following JSON blocks may contain a scene blueprint and the characters
    definition produced by other agents. Use them only as extra context.

    Scene blueprint (may be JSON):
    {scene_blueprint}

    Characters definition (may be JSON):
    {characters}

    === INTERROGATION CONTEXT & LATEST QUESTION ===
    The block below contains the recent Q&A between the detective and the
    chosen suspect, followed by the *latest* question you must answer.

    {player_action}

    Using ONLY the information above, write the chosen suspect's answer to the
    detective's latest question.

    Focus on:
    1. Staying strictly in-character according to the suspect's personality and role.
    2. Answering the detective's latest question directly; do NOT invent a
       different question or a different profession.
    3. Respecting the underlying case logic and any previously revealed facts.
    4. Optionally revealing small new facts or subtle hints.
    5. Keeping the dialogue immersive and relatively concise (around 80–100 words).

  expected_output: >
    You MUST respond with a single valid JSON object, with no markdown,
    no backticks and no extra commentary.

    The JSON must contain exactly these fields:

    {
      "spoken_text": "...",   // the suspect's answer in first person,
                              // natural dialogue, directly answering the latest question.
      "inner_thoughts": "...",// meta-notes about what the suspect is thinking
                              // (for internal use, not shown to the player).
      "revealed_facts": [],   // list of new atomic facts for the backend to add to the game_state
      "implied_clues": []     // optional list of subtle hints suggested by the answer
    }

    - Do NOT include any "Thought:" or analysis outside the JSON.
    - Do NOT wrap the JSON in ``` fences.
    - Do NOT invent a different detective question; answer the one provided
      in the INTERROGATION CONTEXT above.

  agent: dialogue_agent
  # context from other tasks is not needed in this crew, we already pass their
  # outputs explicitly via {scene_blueprint} and {characters}.
  context: []

design_scene_visuals:
  description: >
    Based on the current scene_blueprint, the involved characters and the
    latest suspect dialogue, design image generation prompts that visually
    capture the mood and key elements of the scene. Focus on:
    1. Location, lighting and atmosphere
    2. Important props and visible clues
    3. Framing and composition (what the "camera" sees)
    4. A consistent noir / tech-office aesthetic
  expected_output: >
    A JSON object with:
    - "primary_prompt": one detailed text prompt for image generation
    - "alternate_prompts": 1–2 shorter alternative prompts
    - "style_tags": list of style descriptors (e.g. "noir", "cinematic")
    - "safety_notes": optional notes on what to avoid (e.g. explicit gore)
  agent: vision_agent
  context:
    - create_scene_blueprint
    - define_characters
    - generate_suspect_dialogue

curate_scene_audio:
  description: >
    Using the current scene_blueprint, its music_mood and the emotional tone
    of the latest suspect dialogue, propose a soundtrack and soundscape for
    this scene. Focus on:
    1. Musical genre, mood, tempo and instrumentation
    2. Tension level (low/medium/high)
    3. Ambient sound effects that fit the location and situation
  expected_output: >
    A JSON object with:
    - "music_tags": list of tags describing genre, mood, tempo, instruments
    - "sfx_tags": list of short descriptions of sound effects
    - "prompt_snippet": 1–2 sentences as a prompt for an AI music generator
    - "intensity_level": "low" | "medium" | "high" tension
  agent: audio_agent
  context:
    - create_scene_blueprint
    - generate_suspect_dialogue

game_play_director_step:
  description: >
    Decide what should happen next in the game flow based on the global
    game_state, the defined characters and the latest interaction. Focus on:
    1. Which agent should act next (narrative, dialogue, vision, audio, etc.)
    2. Whether to escalate tension, introduce a new scene, or deepen an existing one
    3. When to offer hints or move towards the final reveal
  expected_output: >
    A JSON control object with:
    - "next_step": high-level description of the next action
    - "target_agent": which agent should be called next
    - "reasoning": brief justification for this choice
    - "flags": optional control flags such as
               "approach_final_reveal": true/false,
               "offer_hint": true/false
  agent: director_agent
  context:
    - create_scene_blueprint
    - define_characters
    - generate_suspect_dialogue
    - design_scene_visuals
    - curate_scene_audio
